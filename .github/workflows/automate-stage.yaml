name: automate stage
on: 
  push:
    branches:
    - "features/**"  
env: 
  credentials: ${{ secrets.AZURE_OPT_NONPROD_CREDENTIALS }}
jobs:    
  automate:
    runs-on: ubuntu-latest
    steps: 
      - name: Install dependencies
        shell: pwsh
        run: |
          Install-Module -Name Az -Repository PSGallery -Force
      - uses: actions/checkout@v2 

      - uses: azure/docker-login@v1
        with:
          login-server: mothershipautregistry.azurecr.io
          username: ${{ secrets.REGISTRY_AUT_USERNAME }}
          password: ${{ secrets.REGISTRY_AUT_PASSWORD }}

      - run: |
          docker build -f ".\azureapp\dockerfile" --force-rm . -t mothershipautregistry.azurecr.io/azureapp:${{ github.sha }}          
          docker push mothershipautregistry.azurecr.io/azureapp:${{ github.sha }}

    